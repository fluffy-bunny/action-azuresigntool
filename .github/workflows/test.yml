name: "build-test"
on: # rebuild any PRs and main branch changes
  pull_request:
  push:
    branches:
      - master
      - 'releases/*'
env:
  AZURE_PATH: '.'    # set this to the path to your web app project, defaults to the repository root
  DOTNET_VERSION: '3.1.102'              # set this to the dotnet version to use

jobs:
  build: # make sure build/ci work properly
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v1
    - run: |
        npm install
        npm run all
  test: # make sure the action works on a clean machine without building
    runs-on: windows-latest
    steps:
    
    - name: Action Checkout
      uses: actions/checkout@v1

    - name: This Action
      uses: ./
      with: 
        milliseconds: 1000
        path: ${env:PATH}
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Setup DotNet ${{ env.DOTNET_VERSION }} Environment
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: 'Install AzureSignTool'
      shell: pwsh
      run: |
        pushd './${{ env.AZURE_PATH }}'
        $a = ($pwd).path
        echo "a:"$a
        dotnet run ./tools/AzureSignTool/netcoreapp2.1/any/AzureSignTool.dll sign -h
        dotnet tool install --global AzureSignTool --version 2.0.17
        popd
        azuresigntool sign -h

         